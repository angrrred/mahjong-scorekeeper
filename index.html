<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¥ –ú–∞–¥–∂–æ–Ω–≥ - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—á–∫–æ–≤</title>
    <style>
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            color: #2c3e50;
        }

        h2 {
            color: #34495e;
            margin: 20px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        h3 {
            color: #7f8c8d;
            margin: 15px 0 10px 0;
        }

        /* ===== –ö–ê–†–¢–û–ß–ö–ò ===== */
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .player-card {
            background: white;
            border-left: 5px solid #3498db;
            margin-bottom: 15px;
        }

        /* ===== –§–û–†–ú–´ ===== */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .player-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* ===== –ö–ù–û–ü–ö–ò ===== */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ===== –¢–ê–ë–õ–ò–¶–´ ===== */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* ===== –°–ß–ï–¢ –ò–ì–†–û–ö–û–í ===== */
        .scores-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .score-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: transform 0.3s;
        }

        .score-item:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .score-item .player-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .score-item .player-score {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .score-item.east {
            border-color: #f39c12;
            background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%);
        }

        .score-item.winner {
            border-color: #2ecc71;
            background: linear-gradient(135deg, #e8f8f1 0%, #d5f4e6 100%);
        }

        /* ===== –¶–í–ï–¢–ê –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô ===== */
        .positive {
            color: #27ae60;
            font-weight: bold;
        }

        .negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .zero {
            color: #7f8c8d;
        }

        /* ===== –ò–°–¢–û–†–ò–Ø ===== */
        .history-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .history-round {
            font-weight: bold;
            color: #2c3e50;
        }

        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ===== –ü–û–ë–ï–î–ò–¢–ï–õ–¨ ===== */
        .winner-section {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 3px solid #f1c40f;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .winner-title {
            font-size: 2em;
            color: #d35400;
            margin-bottom: 10px;
        }

        .winner-name {
            font-size: 3em;
            color: #e74c3c;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ===== –ü–†–û–ì–†–ï–°–°-–ë–ê–† ===== */
        .progress-container {
            margin: 20px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .player-inputs {
                grid-template-columns: 1fr;
            }

            .scores-display {
                grid-template-columns: 1fr;
            }
        }

        /* ===== –°–ö–†–´–¢–´–ï –ë–õ–û–ö–ò ===== */
        .hidden {
            display: none;
        }

        .visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¥ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—á–∫–æ–≤ –¥–ª—è –º–∞–¥–∂–æ–Ω–≥–∞</h1>

        <!-- –≠–ö–†–ê–ù –ù–ê–ß–ê–õ–ê –ò–ì–†–´ -->
        <div id="setupScreen" class="card">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
            <div class="form-group">
                <label for="targetScore">–°—É–º–º–∞ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–±–µ–¥—ã:</label>
                <input type="number" id="targetScore" min="100" max="10000" value="1000">
            </div>
            
            <h3>–ù–∞—á–∞–ª—å–Ω—ã–µ –æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:</h3>
            <div class="player-inputs">
                <div class="form-group">
                    <label for="player1Score">–ò–≥—Ä–æ–∫ 1:</label>
                    <input type="number" id="player1Score" value="0">
                </div>
                <div class="form-group">
                    <label for="player2Score">–ò–≥—Ä–æ–∫ 2:</label>
                    <input type="number" id="player2Score" value="0">
                </div>
                <div class="form-group">
                    <label for="player3Score">–ò–≥—Ä–æ–∫ 3:</label>
                    <input type="number" id="player3Score" value="0">
                </div>
                <div class="form-group">
                    <label for="player4Score">–ò–≥—Ä–æ–∫ 4:</label>
                    <input type="number" id="player4Score" value="0">
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –û–°–ù–û–í–ù–û–ô –ò–ì–†–´ (—Å–∫—Ä—ã—Ç —Å–Ω–∞—á–∞–ª–∞) -->
        <div id="gameScreen" class="hidden">
            <!-- –¢–µ–∫—É—â–∏–π —Å—á–µ—Ç -->
            <div id="currentScores" class="card">
                <h2>üìä –¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</h2>
                <div id="scoresDisplay" class="scores-display">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Å—á–µ—Ç–∞ –∏–≥—Ä–æ–∫–æ–≤ -->
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>–¶–µ–ª—å: <span id="targetDisplay">1000</span> –æ—á–∫–æ–≤</span>
                        <span>–ú–∞–∫—Å–∏–º—É–º: <span id="maxScoreDisplay">0</span></span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
            </div>

            <!-- –ù–æ–≤–∞—è —Ä–∞–∑–¥–∞—á–∞ -->
            <div id="newRound" class="card">
                <h2>üÉè –ù–æ–≤–∞—è —Ä–∞–∑–¥–∞—á–∞</h2>
                
                <div class="form-group">
                    <label for="eastPlayer">–ö—Ç–æ –í–æ—Å—Ç–æ–∫?</label>
                    <select id="eastPlayer">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞...</option>
                        <option value="1">–ò–≥—Ä–æ–∫ 1</option>
                        <option value="2">–ò–≥—Ä–æ–∫ 2</option>
                        <option value="3">–ò–≥—Ä–æ–∫ 3</option>
                        <option value="4">–ò–≥—Ä–æ–∫ 4</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="winnerPlayer">–ö—Ç–æ –≤—ã–∏–≥—Ä–∞–ª?</label>
                    <select id="winnerPlayer">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞...</option>
                        <option value="1">–ò–≥—Ä–æ–∫ 1</option>
                        <option value="2">–ò–≥—Ä–æ–∫ 2</option>
                        <option value="3">–ò–≥—Ä–æ–∫ 3</option>
                        <option value="4">–ò–≥—Ä–æ–∫ 4</option>
                    </select>
                </div>
                
                <h3>–°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:</h3>
                <div class="player-inputs">
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 1:</label>
                        <input type="number" id="cost1" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 2:</label>
                        <input type="number" id="cost2" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 3:</label>
                        <input type="number" id="cost3" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>–ò–≥—Ä–æ–∫ 4:</label>
                        <input type="number" id="cost4" value="0" min="0">
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="calculateRound()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–¥–∞—á—É</button>
                    <button class="btn btn-secondary" onclick="resetRound()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                    <button class="btn btn-danger" onclick="endGame()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–¥–∞—á–∏ -->
            <div id="roundResults" class="card hidden">
                <h2>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–¥–∞—á–∏</h2>
                <div id="resultsTable"></div>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="nextRound()">–°–ª–µ–¥—É—é—â–∞—è —Ä–∞–∑–¥–∞—á–∞</button>
                    <button class="btn btn-secondary" onclick="showHistory()">–ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥–∞—á -->
            <div id="historySection" class="card hidden">
                <h2>üìñ –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥–∞—á</h2>
                <div id="historyList"></div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="hideHistory()">–°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
            <div id="winnerScreen" class="winner-section hidden">
                <div class="winner-title">üèÜ –ü–û–ë–ï–î–ò–¢–ï–õ–¨!</div>
                <div class="winner-name" id="winnerName">–ò–≥—Ä–æ–∫ 1</div>
                <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="finalScore">1000</span> –æ—á–∫–æ–≤</p>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="newGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button class="btn btn-secondary" onclick="showFullResults()">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                </div>
            </div>

            <!-- –ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div id="fullResults" class="card hidden">
                <h2>üìã –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <div id="finalResultsTable"></div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="newGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button class="btn btn-secondary" onclick="hideFullResults()">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–µ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        let gameState = {
            targetScore: 1000,
            scores: {1: 0, 2: 0, 3: 0, 4: 0},
            roundHistory: [],
            currentRound: 0,
            gameActive: false
        };

        // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ò–ù–¢–ï–†–§–ï–ô–°–û–ú =====
        function startGame() {
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            gameState.targetScore = parseInt(document.getElementById('targetScore').value) || 1000;
            
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—á–∫–∏
            gameState.scores[1] = parseInt(document.getElementById('player1Score').value) || 0;
            gameState.scores[2] = parseInt(document.getElementById('player2Score').value) || 0;
            gameState.scores[3] = parseInt(document.getElementById('player3Score').value) || 0;
            gameState.scores[4] = parseInt(document.getElementById('player4Score').value) || 0;
            
            gameState.roundHistory = [];
            gameState.currentRound = 0;
            gameState.gameActive = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateScoresDisplay();
            updateProgressBar();
        }

        function updateScoresDisplay() {
            const scoresDiv = document.getElementById('scoresDisplay');
            scoresDiv.innerHTML = '';
            
            for (let player = 1; player <= 4; player++) {
                const score = gameState.scores[player];
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                
                scoreItem.innerHTML = `
                    <div class="player-name">–ò–≥—Ä–æ–∫ ${player}</div>
                    <div class="player-score">${score}</div>
                `;
                
                scoresDiv.appendChild(scoreItem);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç
            const maxScore = Math.max(...Object.values(gameState.scores));
            document.getElementById('maxScoreDisplay').textContent = maxScore;
            document.getElementById('targetDisplay').textContent = gameState.targetScore;
        }

        function updateProgressBar() {
            const maxScore = Math.max(...Object.values(gameState.scores));
            const progress = Math.min((maxScore / gameState.targetScore) * 100, 100);
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // ===== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–°–ß–ï–¢–ê (–∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ Python) =====
        function calculatePayments(eastPlayer, winner, combinationCosts) {
            let payments = {1: 0, 2: 0, 3: 0, 4: 0};
            let losers = [1, 2, 3, 4].filter(p => p !== winner);

            // –ï—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª –í–æ—Å—Ç–æ–∫
            if (winner == eastPlayer) {
                // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –ø–ª–∞—Ç—è—Ç –¥–≤–æ–π–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –í–æ—Å—Ç–æ–∫–∞
                for (let loser of losers) {
                    let amount = 2 * combinationCosts[winner];
                    payments[loser] -= amount;
                    payments[winner] += amount;
                }

                // –†–∞—Å—á–µ—Ç—ã –º–µ–∂–¥—É –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–º–∏ (–¥–≤–æ–π–Ω—ã–µ —Å—É–º–º—ã)
                for (let i = 0; i < losers.length; i++) {
                    for (let j = i + 1; j < losers.length; j++) {
                        let player1 = losers[i];
                        let player2 = losers[j];

                        if (combinationCosts[player1] > combinationCosts[player2]) {
                            let diff = 2 * (combinationCosts[player1] - combinationCosts[player2]);
                            payments[player2] -= diff;
                            payments[player1] += diff;
                        } else {
                            let diff = 2 * (combinationCosts[player2] - combinationCosts[player1]);
                            payments[player1] -= diff;
                            payments[player2] += diff;
                        }
                    }
                }
            } 
            // –ï—Å–ª–∏ –í–æ—Å—Ç–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª
            else {
                // –í–æ—Å—Ç–æ–∫ –ø–ª–∞—Ç–∏—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—é –¥–≤–æ–π–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
                let amount = 2 * combinationCosts[winner];
                payments[eastPlayer] -= amount;
                payments[winner] += amount;

                // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –ø–ª–∞—Ç—è—Ç –æ–±—ã—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
                let otherLosers = losers.filter(p => p !== eastPlayer);
                for (let loser of otherLosers) {
                    amount = combinationCosts[winner];
                    payments[loser] -= amount;
                    payments[winner] += amount;
                }

                // –†–∞—Å—á–µ—Ç—ã –º–µ–∂–¥—É –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–º–∏
                let losersWithoutEast = losers.filter(p => p !== eastPlayer);
                
                for (let i = 0; i < losersWithoutEast.length; i++) {
                    for (let j = i + 1; j < losersWithoutEast.length; j++) {
                        let player1 = losersWithoutEast[i];
                        let player2 = losersWithoutEast[j];

                        if (combinationCosts[player1] > combinationCosts[player2]) {
                            let diff = combinationCosts[player1] - combinationCosts[player2];
                            payments[player2] -= diff;
                            payments[player1] += diff;
                        } else {
                            let diff = combinationCosts[player2] - combinationCosts[player1];
                            payments[player1] -= diff;
                            payments[player2] += diff;
                        }
                    }
                }

                // –†–∞—Å—á–µ—Ç—ã –í–æ—Å—Ç–æ–∫–∞ —Å –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–º–∏ (–¥–≤–æ–π–Ω—ã–µ —Å—É–º–º—ã)
                for (let loser of losersWithoutEast) {
                    if (combinationCosts[eastPlayer] > combinationCosts[loser]) {
                        let diff = 2 * (combinationCosts[eastPlayer] - combinationCosts[loser]);
                        payments[loser] -= diff;
                        payments[eastPlayer] += diff;
                    } else {
                        let diff = 2 * (combinationCosts[loser] - combinationCosts[eastPlayer]);
                        payments[eastPlayer] -= diff;
                        payments[loser] += diff;
                    }
                }
            }

            return payments;
        }

        function calculateRound() {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
            const eastPlayer = parseInt(document.getElementById('eastPlayer').value);
            const winner = parseInt(document.getElementById('winnerPlayer').value);
            
            if (!eastPlayer || !winner) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –í–æ—Å—Ç–æ–∫–∞ –∏ –ü–æ–±–µ–¥–∏—Ç–µ–ª—è!");
                return;
            }
            
            if (eastPlayer === winner) {
                if (!confirm("–í–Ω–∏–º–∞–Ω–∏–µ: –í–æ—Å—Ç–æ–∫ –≤—ã–∏–≥—Ä–∞–ª —Ä–∞–∑–¥–∞—á—É. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –¥–≤–æ–π–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –æ—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) {
                    return;
                }
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
            const combinationCosts = {
                1: parseInt(document.getElementById('cost1').value) || 0,
                2: parseInt(document.getElementById('cost2').value) || 0,
                3: parseInt(document.getElementById('cost3').value) || 0,
                4: parseInt(document.getElementById('cost4').value) || 0
            };
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–ø–ª–∞—Ç—ã
            const payments = calculatePayments(eastPlayer, winner, combinationCosts);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–¥–∞—á–∏
            gameState.currentRound++;
            const roundData = {
                round: gameState.currentRound,
                eastPlayer: eastPlayer,
                winner: winner,
                combinationCosts: {...combinationCosts},
                payments: {...payments},
                scoresBefore: {...gameState.scores}
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç–∞
            for (let player = 1; player <= 4; player++) {
                gameState.scores[player] += payments[player];
            }
            
            roundData.scoresAfter = {...gameState.scores};
            gameState.roundHistory.push(roundData);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            showRoundResults(roundData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            checkForWinner();
        }

        function showRoundResults(roundData) {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ö–æ–º–±–∏–Ω–∞—Ü–∏—è</th>
                            <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>
                            <th>–°—á–µ—Ç –¥–æ</th>
                            <th>–°—á–µ—Ç –ø–æ—Å–ª–µ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (let player = 1; player <= 4; player++) {
                const payment = roundData.payments[player];
                const changeClass = payment > 0 ? 'positive' : payment < 0 ? 'negative' : 'zero';
                const changeSign = payment > 0 ? '+' : '';
                
                html += `
                    <tr>
                        <td><strong>–ò–≥—Ä–æ–∫ ${player}</strong></td>
                        <td>${roundData.combinationCosts[player]}</td>
                        <td class="${changeClass}">${changeSign}${payment}</td>
                        <td>${roundData.scoresBefore[player]}</td>
                        <td><strong>${roundData.scoresAfter[player]}</strong></td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 15px; padding: 10px; background: #e8f4fd; border-radius: 8px;">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–¥–∞—á–µ:</strong><br>
                    –í–æ—Å—Ç–æ–∫: –ò–≥—Ä–æ–∫ ${roundData.eastPlayer} | –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${roundData.winner} | –ù–æ–º–µ—Ä —Ä–∞–∑–¥–∞—á–∏: ${roundData.round}
                </div>
            `;
            
            document.getElementById('resultsTable').innerHTML = html;
            document.getElementById('roundResults').classList.remove('hidden');
            document.getElementById('newRound').classList.add('hidden');
            
            updateScoresDisplay();
            updateProgressBar();
        }

        function nextRound() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            resetRound();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –Ω–æ–≤–æ–π —Ä–∞–∑–¥–∞—á–∏
            document.getElementById('roundResults').classList.add('hidden');
            document.getElementById('newRound').classList.remove('hidden');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
            document.getElementById('historySection').classList.add('hidden');
        }

        function resetRound() {
            document.getElementById('eastPlayer').value = '';
            document.getElementById('winnerPlayer').value = '';
            document.getElementById('cost1').value = 0;
            document.getElementById('cost2').value = 0;
            document.getElementById('cost3').value = 0;
            document.getElementById('cost4').value = 0;
        }

        function checkForWinner() {
            const maxScore = Math.max(...Object.values(gameState.scores));
            
            if (maxScore >= gameState.targetScore) {
                const winner = Object.keys(gameState.scores).reduce((a, b) => 
                    gameState.scores[a] > gameState.scores[b] ? a : b
                );
                
                document.getElementById('winnerName').textContent = `–ò–≥—Ä–æ–∫ ${winner}`;
                document.getElementById('finalScore').textContent = gameState.scores[winner];
                document.getElementById('winnerScreen').classList.remove('hidden');
                document.getElementById('newRound').classList.add('hidden');
                document.getElementById('roundResults').classList.add('hidden');
                
                gameState.gameActive = false;
            }
        }

        function showHistory() {
            let html = '';
            
            if (gameState.roundHistory.length === 0) {
                html = '<p style="text-align: center; color: #7f8c8d;">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥–∞—á –ø—É—Å—Ç–∞</p>';
            } else {
                for (let round of gameState.roundHistory) {
                    html += `
                        <div class="history-item">
                            <div class="history-round">–†–∞–∑–¥–∞—á–∞ #${round.round}</div>
                            <div>–í–æ—Å—Ç–æ–∫: –ò–≥—Ä–æ–∫ ${round.eastPlayer} | –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${round.winner}</div>
                            <div style="margin-top: 5px; font-size: 0.9em; color: #7f8c8d;">
                                –ò–∑–º–µ–Ω–µ–Ω–∏—è: 
                                ${Object.entries(round.payments)
                                    .map(([p, v]) => `–ò–≥—Ä–æ–∫ ${p}: ${v > 0 ? '+' : ''}${v}`)
                                    .join(', ')}
                            </div>
                        </div>
                    `;
                }
            }
            
            document.getElementById('historyList').innerHTML = html;
            document.getElementById('historySection').classList.remove('hidden');
        }

        function hideHistory() {
            document.getElementById('historySection').classList.add('hidden');
        }

        function endGame() {
            if (confirm("–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É –¥–æ—Å—Ä–æ—á–Ω–æ? –¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.")) {
                showFullResults();
            }
        }

        function showFullResults() {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —Å—á–µ—Ç—É
            const sortedPlayers = Object.entries(gameState.scores)
                .sort((a, b) => b[1] - a[1]);
            
            let place = 1;
            for (let [player, score] of sortedPlayers) {
                html += `
                    <tr>
                        <td>${place}</td>
                        <td>–ò–≥—Ä–æ–∫ ${player}</td>
                        <td><strong>${score}</strong></td>
                    </tr>
                `;
                place++;
            }
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br>
                    –í—Å–µ–≥–æ —Ä–∞–∑–¥–∞—á: ${gameState.roundHistory.length}<br>
                    –¶–µ–ª–µ–≤–æ–π —Å—á–µ—Ç: ${gameState.targetScore}<br>
                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: ${Math.max(...Object.values(gameState.scores))}
                </div>
            `;
            
            document.getElementById('finalResultsTable').innerHTML = html;
            document.getElementById('fullResults').classList.remove('hidden');
            document.getElementById('winnerScreen').classList.add('hidden');
        }

        function hideFullResults() {
            document.getElementById('fullResults').classList.add('hidden');
        }

        function newGame() {
            if (confirm("–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.")) {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                gameState = {
                    targetScore: 1000,
                    scores: {1: 0, 2: 0, 3: 0, 4: 0},
                    roundHistory: [],
                    currentRound: 0,
                    gameActive: false
                };
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('targetScore').value = 1000;
                document.getElementById('player1Score').value = 0;
                document.getElementById('player2Score').value = 0;
                document.getElementById('player3Score').value = 0;
                document.getElementById('player4Score').value = 0;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                document.getElementById('setupScreen').classList.remove('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('winnerScreen').classList.add('hidden');
                document.getElementById('fullResults').classList.add('hidden');
                document.getElementById('historySection').classList.add('hidden');
                document.getElementById('roundResults').classList.add('hidden');
                document.getElementById('newRound').classList.remove('hidden');
                
                resetRound();
            }
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï =====
        document.addEventListener('DOMContentLoaded', function() {
            updateScoresDisplay();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#667eea';
                });
                input.addEventListener('blur', function() {
                    this.style.borderColor = '#dee2e6';
                });
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('newRound').classList.contains('hidden') === false) {
                    calculateRound();
                }
            });
        });

        // ===== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–î–û–ë–°–¢–í–ê =====
        function autoFillTestData() {
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            document.getElementById('eastPlayer').value = Math.floor(Math.random() * 4) + 1;
            document.getElementById('winnerPlayer').value = Math.floor(Math.random() * 4) + 1;
            
            for (let i = 1; i <= 4; i++) {
                document.getElementById('cost' + i).value = Math.floor(Math.random() * 50) * 10;
            }
            
            alert("–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–¥–∞—á—É'.");
        }

        // –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –¥–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—É—é –∫–Ω–æ–ø–∫—É
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                autoFillTestData();
            }
        });
    </script>

    <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ -->
    <div style="position: fixed; bottom: 10px; right: 10px; opacity: 0.1;">
        <button onclick="autoFillTestData()" title="Ctrl+Shift+T">–¢–µ—Å—Ç</button>
    </div>
</body>
</html>
